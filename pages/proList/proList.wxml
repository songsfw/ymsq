<!-- index.wxml -->
<import src="../../template/loading/loading.wxml" />
<template is="loading" data="{{showLoading}}"></template>
<wxs module="filter" src="../../utils/tools.wxs"></wxs>
<view class="menu">
  <view class="main flex">
    <block wx:for="{{menu}}" wx:for-index="index">
      <view bind:tap="switchTab" class="flex-1 {{currentTab==item.value ? 'on' : ''}}" data-tabid="{{item.value}}">
        {{item.name}}
      </view>
    </block>
  </view>
  <view class="sub-wrap" wx:if="{{showCategory[currentTab].length!=0}}">
    <scroll-view class="sub {{isFixed?'fixed':''}}" scroll-x="{{true}}">
      <view class="flex">
        <text data-id="null" data-tagname="全部" wx:if="{{showCategory[currentTab]}}" class="{{!cateChosed[currentTab]?'on':''}}"
          bind:tap="selectCategory">全部</text>
        <block wx:for="{{showCategory[currentTab]}}" wx:for-index="index">
          <text data-id="{{item.tid}}" data-tagname="{{item.name}}" class="{{cateChosed[currentTab]==item.tid?'on':''}}"
            bind:tap="selectCategory">{{item.name}}</text>
        </block>
      </view>
    </scroll-view>
  </view>
  <view wx:else  style="padding-top:24rpx;"></view>
</view>

<!-- 组合 -->
<block>
  <view class="pro-box" wx:if="{{showList[currentTab].length > 0}}">
    <block wx:if="{{!showList[currentTab]}}">
      不存在
      <view class="nodata">
        <image src="../../image/no-data.png"></image>
        <view class="txt">暂无内容</view>
      </view>
    </block>

    <block wx:else>
      <view class="listItemwp flex">
        <block wx:for="{{showList[currentTab]}}" wx:for-index="idx">
          <block wx:for="{{item}}" wx:for-item="pro" wx:for-index="itemIdx">
            <view class="item" bind:tap="toProInfo" data-proid="{{pro.meal_id}}" data-spuid="{{pro.spu_id}}" data-type="{{pro.type}}">
              <view class="pic {{showStock[currentTab][pro.meal_id]==0?'sold-out':''}}">
                <view class="tag">已售罄</view>
                <image src="{{pro.img}}" lazy-load="{{true}}" mode="aspectFill"></image>
              </view>
              <view class="info">
                <view class="tit text-overflow">{{pro.name}}</view>
                <view class="tags text-overflow">
                  <text wx:for="{{pro.tags}}" wx:for-index="key" wx:for-item="tag">{{pro.tags[key]}}</text>
                </view>
                <view class="price flex">
                  <view class="num">￥<text>{{pro.price}}</text></view>
                  <view wx:if="{{showStock[currentTab][pro.meal_id]!=0 }}"
                    class="add iconfont icon-add pro-{{pro.meal_id}}" catch:tap="addCart" data-img="{{pro.img}}"
                    data-id="{{pro.meal_id}}" data-idx="{{idx}}"
                    data-itemidx="{{itemIdx}}" data-typeMealIdSpuId="{{pro.type}}_{{pro.meal_id}}_{{pro.spu_id}}" data-type="{{pro.type}}" data-spuid="{{pro.spu_id}}">
                    <text wx:if="{{pro.selectNumberLength>0}}" class="cart-motion-t"
                      style="{{pro.cornerTagStyle}}">{{pro.selected}}</text>
                  </view>
                </view>
              </view>
            </view>

          </block>
        </block>
      </view>
      <view wx:if="{{breadInfo.noMoreData}}" class="more-btn">我可是有底线的</view>
      <!-- <view wx:else class="more-btn">
      <view class="nodata">
        <view class="txt">加载中</view>
      </view>
    </view> -->
    </block>
  </view>
</block>
<!-- <toCart style="position:absolute;top:0;right: 0;" id="componentsToCart"></toCart> -->